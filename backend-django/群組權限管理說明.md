# ç¾¤çµ„æ¬Šé™ç®¡ç†èªªæ˜

## ğŸ” æ–°å¢ç¾¤çµ„ï¼ˆGroupï¼‰æ¬Šé™

### ç•¶å‰æ¬Šé™è¨­å®š

**èª°å¯ä»¥æ–°å¢ç¾¤çµ„ï¼Ÿ**
- âœ… **ADMINï¼ˆè¶…ç´šç®¡ç†å“¡ï¼‰**ï¼šå¯ä»¥å‰µå»ºç¾¤çµ„
- âŒ **USERï¼ˆä¸€èˆ¬ç”¨æˆ¶ï¼‰**ï¼šç„¡æ³•å‰µå»ºç¾¤çµ„
- âŒ **ç¾¤çµ„ç®¡ç†è€…**ï¼šç„¡æ³•å‰µå»ºç¾¤çµ„ï¼ˆåªèƒ½ç®¡ç†æ—¢æœ‰ç¾¤çµ„ï¼‰

### æ¬Šé™æª¢æŸ¥é‚è¼¯

#### å¾Œç«¯æ¬Šé™
```python
# apps/groups/views.py
class GroupViewSet(viewsets.ModelViewSet):
    permission_classes = [permissions.IsAuthenticated]
    
    def perform_create(self, serializer):
        serializer.save(created_by=self.request.user)
```

**èªªæ˜**ï¼šå¾Œç«¯åªæª¢æŸ¥ç”¨æˆ¶æ˜¯å¦å·²ç™»å…¥ï¼ˆ`IsAuthenticated`ï¼‰ï¼Œæ²’æœ‰è§’è‰²é™åˆ¶ã€‚

#### å‰ç«¯æ¬Šé™
```typescript
// frontend/src/pages/Groups.tsx
const canCreateGroups = (): boolean => {
  return currentUser?.role === 'ADMIN'
}
```

**èªªæ˜**ï¼šå‰ç«¯é™åˆ¶åªæœ‰ ADMIN è§’è‰²å¯ä»¥çœ‹åˆ°ã€Œå‰µå»ºç¾¤çµ„ã€æŒ‰éˆ•å’Œè¡¨å–®ã€‚

## ğŸ“Š ç¾¤çµ„ç›¸é—œæ¬Šé™çŸ©é™£

| è§’è‰²é¡å‹ | å‰µå»ºç¾¤çµ„ | ç·¨è¼¯ç¾¤çµ„ | åˆªé™¤ç¾¤çµ„ | ç®¡ç†æˆå“¡ | æŸ¥çœ‹ç¾¤çµ„ |
|---------|---------|---------|---------|---------|---------|
| ADMIN | âœ… | âœ… | âœ… | âœ… | âœ… |
| ç¾¤çµ„ç®¡ç†è€… | âŒ | âœ…* | âŒ | âœ…* | âœ…* |
| ç¾¤çµ„æˆå“¡ | âŒ | âŒ | âŒ | âŒ | âœ…* |
| ä¸€èˆ¬ç”¨æˆ¶ | âŒ | âŒ | âŒ | âŒ | âŒ |

*åƒ…é™è‡ªå·±ç®¡ç†/åƒèˆ‡çš„ç¾¤çµ„

## ğŸ”§ ç¾¤çµ„ç®¡ç†è€…çš„æ¬Šé™

### å¦‚ä½•æˆç‚ºç¾¤çµ„ç®¡ç†è€…ï¼Ÿ
1. **å‰µå»ºç¾¤çµ„æ™‚æŒ‡å®š**ï¼šADMIN å‰µå»ºç¾¤çµ„æ™‚å¯ä»¥æŒ‡å®šç®¡ç†è€…
2. **å¾ŒçºŒæ–°å¢**ï¼šç”± ADMIN æˆ–ç¾æœ‰ç¾¤çµ„ç®¡ç†è€…æ–°å¢

### ç¾¤çµ„ç®¡ç†è€…å¯ä»¥åšä»€éº¼ï¼Ÿ
```python
# apps/groups/models.py
def is_manager(self, user) -> bool:
    """æª¢æŸ¥æŒ‡å®šç”¨æˆ¶æ˜¯å¦ç‚ºæ­¤ç¾¤çµ„çš„ç®¡ç†è€…"""
    if user.role == 'ADMIN':  # ç³»çµ±ç®¡ç†å“¡é è¨­ç‚ºæ‰€æœ‰ç¾¤çµ„çš„ç®¡ç†è€…
        return True
    return self.managers.filter(id=user.id).exists()
```

**ç¾¤çµ„ç®¡ç†è€…æ¬Šé™**ï¼š
- âœ… ç·¨è¼¯ç¾¤çµ„è³‡è¨Šï¼ˆåç¨±ã€æè¿°ï¼‰
- âœ… æ–°å¢/ç§»é™¤ç¾¤çµ„æˆå“¡
- âœ… æŒ‡å®šå…¶ä»–ç¾¤çµ„ç®¡ç†è€…
- âœ… å‰µå»ºæ´»å‹•ï¼ˆé€é `managed_groups` ç²å¾—æ¬Šé™ï¼‰
- âŒ åˆªé™¤ç¾¤çµ„
- âŒ å‰µå»ºæ–°ç¾¤çµ„

## ğŸš€ æ¬Šé™æå‡å»ºè­°

### ç•¶å‰é™åˆ¶
ç›®å‰åªæœ‰ ADMIN å¯ä»¥å‰µå»ºç¾¤çµ„ï¼Œé€™åœ¨å¤§å‹å®¶æ—ä¸­å¯èƒ½éæ–¼é™åˆ¶ã€‚

### å»ºè­°çš„æ¬Šé™æ“´å±•

#### é¸é … 1ï¼šå…è¨±ç¾¤çµ„ç®¡ç†è€…å‰µå»ºç¾¤çµ„
```typescript
// å‰ç«¯ä¿®æ”¹å»ºè­°
const canCreateGroups = (): boolean => {
  if (!currentUser) return false
  
  // ADMIN å¯ä»¥å‰µå»ºç¾¤çµ„
  if (currentUser.role === 'ADMIN') return true
  
  // ç¾¤çµ„ç®¡ç†è€…ä¹Ÿå¯ä»¥å‰µå»ºç¾¤çµ„
  if (currentUser.managed_groups && currentUser.managed_groups.length > 0) return true
  
  return false
}
```

#### é¸é … 2ï¼šå…è¨±æ‰€æœ‰ç”¨æˆ¶å‰µå»ºç¾¤çµ„
```typescript
// å®Œå…¨é–‹æ”¾ç‰ˆæœ¬
const canCreateGroups = (): boolean => {
  return !!currentUser  // ä»»ä½•ç™»å…¥ç”¨æˆ¶éƒ½å¯ä»¥å‰µå»ºç¾¤çµ„
}
```

## ğŸ“‹ ç¾¤çµ„å‰µå»ºæµç¨‹

### ç•¶å‰æµç¨‹ï¼ˆADMIN onlyï¼‰
1. ADMIN ç™»å…¥ç³»çµ±
2. é€²å…¥ç¾¤çµ„ç®¡ç†é é¢
3. é»æ“Šã€Œå‰µå»ºç¾¤çµ„ã€
4. å¡«å¯«ç¾¤çµ„è³‡è¨Šï¼š
   - ç¾¤çµ„åç¨±ï¼ˆå¿…å¡«ï¼‰
   - ç¾¤çµ„æè¿°ï¼ˆé¸å¡«ï¼‰
   - æŒ‡å®šç®¡ç†è€…ï¼ˆé¸å¡«ï¼Œå¯å¤šé¸ï¼‰
5. æäº¤å‰µå»º

### å‰µå»ºå¾Œçš„è‡ªå‹•è¨­å®š
```python
# apps/groups/views.py
def perform_create(self, serializer):
    serializer.save(created_by=self.request.user)
```

**å‰µå»ºè€…æ¬Šé™**ï¼š
- å‰µå»ºè€…è‡ªå‹•æˆç‚ºè©²ç¾¤çµ„çš„ç®¡ç†è€…
- å¯ä»¥å¾ŒçºŒç·¨è¼¯ç¾¤çµ„å’Œç®¡ç†æˆå“¡

## ğŸ” ç¾¤çµ„æˆå“¡ç®¡ç†

### æˆå“¡é¡å‹
```python
# apps/groups/models.py
class GroupMember(models.Model):
    group = models.ForeignKey(Group)
    name = models.CharField(max_length=100)  # æˆå“¡å§“å
    user = models.ForeignKey(User, null=True, blank=True)  # å¯é¸çš„ç³»çµ±ç”¨æˆ¶é—œè¯
    
    @property
    def is_system_user(self) -> bool:
        return self.user is not None
```

**æ”¯æ´å…©ç¨®æˆå“¡**ï¼š
1. **ç³»çµ±ç”¨æˆ¶**ï¼šæœ‰å¸³è™Ÿå¯ç™»å…¥çš„ç”¨æˆ¶
2. **éç³»çµ±ç”¨æˆ¶**ï¼šåªæœ‰å§“åè¨˜éŒ„çš„å®¶æ—æˆå“¡

### æˆå“¡ç®¡ç†æ¬Šé™
- **ADMIN**ï¼šå¯ç®¡ç†æ‰€æœ‰ç¾¤çµ„çš„æ‰€æœ‰æˆå“¡
- **ç¾¤çµ„ç®¡ç†è€…**ï¼šå¯ç®¡ç†è‡ªå·±ç®¡ç†çš„ç¾¤çµ„æˆå“¡
- **å…¶ä»–ç”¨æˆ¶**ï¼šç„¡æ³•ç®¡ç†æˆå“¡

## ğŸ›¡ï¸ å®‰å…¨è€ƒé‡

### æ¬Šé™æª¢æŸ¥å±¤ç´š
1. **å‰ç«¯æª¢æŸ¥**ï¼šUI å±¤é¢é™åˆ¶ï¼Œé˜²æ­¢èª¤æ“ä½œ
2. **å¾Œç«¯æª¢æŸ¥**ï¼šAPI å±¤é¢é©—è­‰ï¼ŒçœŸæ­£çš„å®‰å…¨é˜²è­·
3. **è³‡æ–™åº«ç´„æŸ**ï¼šæ¨¡å‹å±¤é¢çš„å®Œæ•´æ€§ä¿è­·

### å»ºè­°åŠ å¼·å¾Œç«¯æ¬Šé™
```python
# å»ºè­°çš„å¾Œç«¯æ¬Šé™æª¢æŸ¥
class GroupViewSet(viewsets.ModelViewSet):
    def get_permissions(self):
        if self.action == 'create':
            # å¯ä»¥æ ¹æ“šéœ€æ±‚èª¿æ•´å‰µå»ºæ¬Šé™
            return [permissions.IsAuthenticated()]
        elif self.action in ['update', 'partial_update', 'destroy']:
            return [permissions.IsAuthenticated()]
        return [permissions.IsAuthenticated()]
    
    def check_group_permissions(self, request, group=None):
        """æª¢æŸ¥ç¾¤çµ„æ“ä½œæ¬Šé™"""
        if request.user.role == 'ADMIN':
            return True
        if group and group.is_manager(request.user):
            return True
        return False
```

## ğŸ“ ç¸½çµ

**ç•¶å‰ç¾¤çµ„æ¬Šé™ç‰¹é»**ï¼š
- âœ… ç°¡å–®æ¸…æ™°ï¼šåªæœ‰ ADMIN èƒ½å‰µå»ºç¾¤çµ„
- âœ… å®‰å…¨ç©©å®šï¼šé¿å…ç¾¤çµ„æ°¾æ¿«
- âŒ å¯èƒ½éæ–¼é™åˆ¶ï¼šå¤§å®¶æ—ä¸­å¯èƒ½éœ€è¦æ›´éˆæ´»çš„æ¬Šé™

**å»ºè­°æ ¹æ“šå¯¦éš›ä½¿ç”¨æƒ…æ³**ï¼š
- å°å®¶æ—ï¼šä¿æŒç¾ç‹€ï¼ˆADMIN onlyï¼‰
- å¤§å®¶æ—ï¼šè€ƒæ…®å…è¨±ç¾¤çµ„ç®¡ç†è€…å‰µå»ºç¾¤çµ„
- é–‹æ”¾ç’°å¢ƒï¼šå…è¨±æ‰€æœ‰ç”¨æˆ¶å‰µå»ºç¾¤çµ„

é¸æ“‡æ¬Šé™ç­–ç•¥æ™‚éœ€è¦å¹³è¡¡**ä¾¿åˆ©æ€§**å’Œ**ç®¡ç†è¤‡é›œåº¦**ã€‚