# 完整測試情境指南 🧪

## 🎯 測試資料概覽

我們已經建立了完整的測試場景，包含：
- **8個用戶**：1個admin + 7個家庭成員
- **4個群組**：核心家庭、大家庭聚會、年輕人小組、長輩聯誼會
- **4個活動**：不同狀態和權限設定的活動
- **6筆交易**：各種分攤類型的支出記錄

## 👥 測試用戶與角色

| 用戶名 | 角色描述 | 群組管理權限 | 測試重點 |
|-------|---------|-------------|---------|
| **admin** | 系統超級管理員 | 所有群組 | 最高權限測試 |
| **alice** | 媽媽，核心家庭管理者 | 核心家庭 | 群組管理者權限 |
| **bob** | 爸爸，一般用戶 | 無 | 活動參與者權限 |
| **charlie** | 大兒子，年輕人管理者 | 年輕人小組 | 群組管理者權限 |
| **diana** | 小女兒，一般用戶 | 無 | 一般用戶權限 |
| **edward** | 爺爺，大家庭管理者 | 大家庭聚會 | 特殊情境測試 |
| **fiona** | 奶奶，一般用戶 | 無 | 長輩用戶權限 |
| **george** | 叔叔，一般用戶 | 無 | 一般用戶權限 |

**所有用戶密碼：`password123`**

## 🏠 群組結構

### 1. 核心家庭（alice 管理）
- **成員**：alice, bob, charlie, diana
- **用途**：日常家庭支出

### 2. 大家庭聚會（edward 管理）
- **成員**：alice, bob, charlie, diana, edward, fiona, george
- **用途**：家族聚會活動

### 3. 年輕人小組（charlie 管理）
- **成員**：charlie, diana  
- **用途**：年輕人聚會

### 4. 長輩聯誼會（僅admin管理）
- **成員**：edward, fiona, george
- **用途**：長輩專用，測試特殊權限

## 🎉 測試活動場景

### 1. 家庭週末墾丁之旅 ⭐ 重點測試
- **管理者**：alice
- **狀態**：ACTIVE（進行中）
- **參與者**：alice, bob, charlie, diana
- **分攤**：允許，預算15,000元
- **交易數**：3筆（住宿、餐飲、交通）

### 2. 年輕人火鍋聚會
- **管理者**：charlie
- **狀態**：ACTIVE（進行中）
- **參與者**：charlie, diana
- **分攤**：允許，預算2,000元
- **交易數**：1筆

### 3. 春節家族團圓飯 ⭐ 重點測試
- **管理者**：edward
- **狀態**：COMPLETED（已完成）
- **參與者**：全家7人
- **分攤**：允許，預算8,000元
- **交易數**：1筆
- **測試點**：已完成活動的權限控制

### 4. 長輩健康檢查 ⭐ 重點測試
- **管理者**：admin, edward
- **狀態**：ACTIVE（計劃中）
- **參與者**：fiona, george
- **分攤**：不允許，預算12,000元
- **交易數**：1筆
- **測試點**：edward是管理者但非參與者

## 🧪 關鍵測試情境

### 🔐 權限測試

#### 測試1: 新增活動按鈕顯示
**目標**：驗證不同用戶能否看到「新增活動」按鈕

| 用戶 | 預期結果 | 測試方法 |
|-----|---------|---------|
| admin | ✅ 顯示 | 登入查看 /activities |
| alice | ✅ 顯示 | 管理核心家庭 |
| edward | ✅ 顯示 | 管理大家庭聚會 |
| charlie | ✅ 顯示 | 管理年輕人小組 |
| bob, diana, fiona, george | ❌ 隱藏 | 一般用戶無權限 |

#### 測試2: 新增支出權限
**目標**：驗證在不同活動狀態下的支出新增權限

**2.1 進行中活動（墾丁旅行）**
```
✅ 可新增支出：alice, bob, charlie, diana（參與者）
❌ 無法新增：edward, fiona, george（非參與者）
```

**2.2 已完成活動（春節聚會）**
```
✅ 可新增支出：edward（管理者）, admin（超級管理員）
❌ 無法新增：alice, bob, charlie（一般參與者）
```

**2.3 管理者非參與者（健檢活動）**
```
✅ 可新增支出：edward（管理者非參與者）, admin, fiona, george
❌ 無法新增：alice, bob, charlie, diana
```

#### 測試3: 活動編輯權限
**目標**：驗證活動編輯頁面的進入權限

```
✅ admin：可編輯所有活動
✅ alice：只能編輯墾丁旅行
✅ charlie：只能編輯火鍋聚會  
✅ edward：可編輯春節聚會和健檢活動
❌ bob, diana, fiona, george：無法編輯任何活動
```

### 💰 分攤功能測試

#### 測試4: 分攤計算驗證

**4.1 平均分攤（住宿費）**
- 總金額：3,200元
- 參與者：4人
- 預期結果：每人800元

**4.2 比例分攤（交通費）**  
- 總金額：1,200元
- 比例設定：大人1.5，小孩1.0
- 預期結果：
  - alice: 360元（1.5倍）
  - bob: 360元（1.5倍）
  - charlie: 240元（1.0倍）
  - diana: 240元（1.0倍）

**4.3 跨群組分攤（春節聚會）**
- 總金額：5,500元
- 參與者：7人（來自不同群組）
- 預期結果：每人785.71元

### 🚨 錯誤情境測試

#### 測試5: 權限拒絕測試

**5.1 一般用戶嘗試新增活動**
```
用戶：bob
操作：直接訪問 /activities/new
預期：被重定向到 /activities
```

**5.2 非參與者新增支出**
```
用戶：edward  
操作：在墾丁旅行中新增支出
預期：顯示權限錯誤信息
```

**5.3 一般參與者在已完成活動新增支出**
```
用戶：alice
操作：在春節聚會（已完成）中新增支出  
預期：顯示權限錯誤信息
```

## 🔧 測試執行步驟

### 步驟1: 環境準備
1. 確保後端服務運行：`python manage.py runserver`
2. 確保前端服務運行：`npm start`
3. 打開瀏覽器訪問：`http://localhost:3000`

### 步驟2: 基礎權限測試
1. **登入測試各用戶**
   ```bash
   # 測試帳號列表
   admin / password123
   alice / password123  
   charlie / password123
   edward / password123
   bob / password123
   ```

2. **檢查Activities頁面**
   - 記錄哪些用戶看到「新增活動」按鈕
   - 驗證按鈕點擊後能否成功進入ActivityNew頁面

3. **檢查TransactionNew頁面**
   - 不同用戶可選擇的活動選項
   - 已結束活動是否正確標示和限制

### 步驟3: 深度功能測試  
1. **新增支出測試**
   - 在不同活動中嘗試新增支出
   - 驗證權限錯誤信息是否正確顯示

2. **分攤計算測試**
   - 建立不同類型的分攤支出
   - 驗證分攤金額計算正確性

3. **特殊情境測試**
   - edward在健檢活動中的管理者非參與者權限
   - 已完成活動的支出新增限制

## 📊 測試結果記錄表

### 權限測試結果
| 用戶 | 看到新增活動按鈕 | 能進入ActivityNew | 能編輯活動 | 備註 |
|-----|----------------|------------------|-----------|------|
| admin | ⬜ | ⬜ | ⬜ | |
| alice | ⬜ | ⬜ | ⬜ | |
| charlie | ⬜ | ⬜ | ⬜ | |
| edward | ⬜ | ⬜ | ⬜ | |
| bob | ⬜ | ⬜ | ⬜ | |

### 支出新增權限測試
| 活動 | alice | bob | charlie | diana | edward | fiona | george |
|-----|-------|-----|---------|-------|--------|-------|--------|
| 墾丁旅行（進行中） | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ |
| 春節聚會（已完成） | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ |
| 健檢活動（特殊） | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ |

## 🎉 測試完成後清理

如果需要重新建立測試資料：
```bash
cd backend-django
source venv/bin/activate
python create_test_scenarios.py
```

## 💡 測試提醒

1. **記錄發現的問題**：任何與預期不符的行為都應詳細記錄
2. **截圖保存**：重要的錯誤或成功畫面應該截圖保存  
3. **跨瀏覽器測試**：在Chrome、Safari、Firefox中測試
4. **手機端測試**：檢查響應式設計是否正常工作

這個測試場景涵蓋了系統的所有關鍵權限邏輯和業務流程，通過完整測試可以確保系統的穩定性和正確性！